(()=>{"use strict";const e="kwang-shopping";AWS.config.update({region:"ap-northeast-2",credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:"ap-northeast-2:b6a1fa02-993d-437d-9ed5-7134db218241"})});new AWS.S3({apiVersion:"2006-03-01",params:{Bucket:e}});async function t(t,o){const a=t.files;if(!a.length)throw new Error("사진 파일을 업로드해 주세요.");const n=a[0],r=Math.random().toString(36).substring(2,7)+"_"+n.name,c=encodeURIComponent(o)+"/"+r,i=new AWS.S3.ManagedUpload({params:{Bucket:e,Key:c,Body:n}});try{const e=await i.promise(),t=e.Key;return console.log(e),console.log(`AWS S3에 정상적으로 사진이 업로드되었습니다.\n파일 위치: ${t}`),t}catch(e){throw new Error(`S3에 업로드하는 과정에서 에러가 발생하였습니다.\n${e.message}`)}}const o=e=>{const t=e.split(" "),o=document.querySelector("#navbar"),a=!!localStorage.getItem("token"),n=!!localStorage.getItem("admin"),r={register:'<li><a href="/register">회원가입</a></li>',login:'<li><a href="/login">로그인</a></li>'},c={account:'<li><a href="/account">계정관리</a></li>',logout:'<li><a href="#" id="logout">로그아웃</a></li>',productAdd:'<li><a href="/product/add">제품 추가</a></li>',categoryAdd:'<li><a href="/category/add">카테고리 추가</a></li>'},i={admin:'<li><a href="/admin">페이지관리</a></li>'},l=document.createElement("script");l.innerText="\n      const logoutElem = document.querySelector('#logout'); \n      \n      if (logoutElem) {\n        logoutElem.addEventListener('click', () => {\n          localStorage.removeItem('token');\n          localStorage.removeItem('admin');\n\n          window.location.href = '/';\n        });\n      }\n  ";let s="";for(const e of t)n&&(s+=i[e]??""),s+=a?c[e]??"":r[e]??"";o.insertAdjacentHTML("afterbegin",s),o.after(l)},a=document.querySelector("#titleInput"),n=document.querySelector("#descriptionInput"),r=document.querySelector("#themeSelectBox"),c=document.querySelector("#imageInput"),i=document.querySelector("#fileNameSpan"),l=document.querySelector("#addCategoryButton"),s=document.querySelector("#registerCategoryForm");async function d(e){e.preventDefault();const o=a.value,l=n.value,d=r.value,u=c.files[0];if(!o||!l)return alert("빈 칸이 없어야 합니다.");if(!d)return alert("테마를 선택해 주세요.");if(u.size>3e6)return alert("사진은 최대 2.5MB 크기까지 가능합니다.");try{const e={title:o,description:l,themeClass:d,imageKey:await t(c,"category")};await async function(e,t){const o=e,a=JSON.stringify(t);console.log(`%cPOST 요청: ${o}`,"color: #296aba;"),console.log(`%cPOST 요청 데이터: ${a}`,"color: #296aba;");const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:a});if(!n.ok){const e=await n.json(),{reason:t}=e;throw new Error(t)}return await n.json()}("/api/category",e),alert(`정상적으로 ${o} 카테고리가 등록되었습니다.`),s.reset(),i.innerText="",r.style.backgroundColor="white",r.style.color="black"}catch(e){console.error(e.stack),alert(`문제가 발생하였습니다. 확인 후 다시 시도해 주세요: ${e.message}`)}}function u(){const e=c.files[0];i.innerText=e?e.name:""}function g(){const e=r.selectedIndex;r.style.color=r[e].style.color,r.style.backgroundColor=r[e].style.backgroundColor}(()=>{if(!localStorage.getItem("token")){const e=window.location.pathname,t=window.location.search;window.location.replace(`/login?previouspage=${e+t}`)}})(),async function(){(()=>{switch(window.location.pathname){case"/":case"/cart/":case"/product/detail/":case"/product/list/":o("admin register login account logout");break;case"/account/orders/":case"/account/security/":case"/account/signout/":case"/admin/orders/":case"/admin/users/":case"/order/complete/":case"/order/":case"/product/add/":o("admin account logout");break;case"/account/":o("admin logout");break;case"/admin/":o("account logout");break;case"/category/add/":o("admin account productAdd logout");break;case"/login/":o("register");break;case"/register/":o("login")}})()}(),l.addEventListener("click",d),r.addEventListener("change",g),c.addEventListener("change",u)})();