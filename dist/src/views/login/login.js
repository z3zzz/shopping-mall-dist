(()=>{"use strict";async function e(e,o){const t=e,a=JSON.stringify(o);console.log(`%cPOST 요청: ${t}`,"color: #296aba;"),console.log(`%cPOST 요청 데이터: ${a}`,"color: #296aba;");const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:a});if(!n.ok){const e=await n.json(),{reason:o}=e;throw new Error(o)}return await n.json()}const o=()=>{const e=window.location.search,o=new URLSearchParams(e),t={};for(const[e,a]of o)t[e]=a;return t},t=e=>{const o=e.split(" "),t=document.querySelector("#navbar"),a=!!localStorage.getItem("token"),n=!!localStorage.getItem("admin"),c={register:'<li><a href="/register">회원가입</a></li>',login:'<li><a href="/login">로그인</a></li>'},r={account:'<li><a href="/account">계정관리</a></li>',logout:'<li><a href="#" id="logout">로그아웃</a></li>',productAdd:'<li><a href="/product/add">제품 추가</a></li>',categoryAdd:'<li><a href="/category/add">카테고리 추가</a></li>'},i={admin:'<li><a href="/admin">페이지관리</a></li>'},l=document.createElement("script");l.innerText="\n      const logoutElem = document.querySelector('#logout'); \n      \n      if (logoutElem) {\n        logoutElem.addEventListener('click', () => {\n          localStorage.removeItem('token');\n          localStorage.removeItem('admin');\n\n          window.location.href = '/';\n        });\n      }\n  ";let s="";for(const e of o)n&&(s+=i[e]??""),s+=a?r[e]??"":c[e]??"";t.insertAdjacentHTML("afterbegin",s),t.after(l)},a=document.querySelector("#emailInput"),n=document.querySelector("#passwordInput"),c=document.querySelector("#submitButton"),r=(document.querySelector("#googleLoginButton"),document.querySelector("#kakaoLoginButton"));async function i(t){t.preventDefault();const c=a.value,r=n.value,i=(e=>String(e).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/))(c),l=r.length>=4;if(!i||!l)return alert("비밀번호가 4글자 이상인지, 이메일 형태가 맞는지 확인해 주세요.");try{const t={email:c,password:r},a=await e("/api/login",t),{token:n,isAdmin:i}=a;localStorage.setItem("token",n),alert("정상적으로 로그인되었습니다."),i&&localStorage.setItem("admin","admin");const{previouspage:l}=o();if(l)return void(window.location.href=l);window.location.href="/"}catch(e){console.error(e.stack),alert(`문제가 발생하였습니다. 확인 후 다시 시도해 주세요: ${e.message}`)}}function l(){Kakao.API.request({url:"/v2/user/me",data:{property_keys:["kakao_account.email"]},success:s,fail:e=>console.log(e)})}async function s(t){const{email:a}=t.kakao_account;try{const t={email:a},n=(await e("/api/login/kakao",t)).token;localStorage.setItem("token",n),alert("정상적으로 로그인되었습니다.");const{previouspage:c}=o();if(c)return void(window.location.href=c);window.location.href="/"}catch(e){console.error(e.stack),alert(`문제가 발생하였습니다. 확인 후 다시 시도해 주세요: ${e.message}`)}}localStorage.getItem("token")&&(alert("로그인 상태에서는 접근할 수 없는 페이지입니다."),window.location.replace("/")),async function(){(()=>{switch(window.location.pathname){case"/":case"/cart/":case"/product/detail/":case"/product/list/":t("admin register login account logout");break;case"/account/orders/":case"/account/security/":case"/account/signout/":case"/admin/orders/":case"/admin/users/":case"/order/complete/":case"/order/":case"/product/add/":t("admin account logout");break;case"/account/":t("admin logout");break;case"/admin/":t("account logout");break;case"/category/add/":t("admin account productAdd logout");break;case"/login/":t("register");break;case"/register/":t("login")}})(),Kakao.init("b1fa466bef2a7006e303f09b63eb990c"),r.addEventListener("click",(e=>{e.preventDefault(),Kakao.Auth.login({success:l,fail:e=>console.log(e)})}))}(),c.addEventListener("click",i)})();